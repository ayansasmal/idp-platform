apiVersion: v1
kind: ConfigMap
metadata:
  name: backstage-app-config
  namespace: backstage
  labels:
    app.kubernetes.io/name: backstage
    app.kubernetes.io/part-of: idp-platform
data:
  app-config.yaml: |
    app:
      title: IDP Platform Portal
      baseUrl: http://localhost:3000
      support:
        url: https://github.com/your-org/idp-platform/issues
        items:
          - title: Issues
            icon: github
            links:
              - url: https://github.com/your-org/idp-platform/issues
                title: GitHub Issues

    organization:
      name: IDP Platform

    backend:
      baseUrl: http://localhost:7007
      listen:
        port: 7007
      csp:
        connect-src: ["'self'", 'http:', 'https:']
      cors:
        origin: http://localhost:3000
        methods: [GET, HEAD, PATCH, POST, PUT, DELETE]
        credentials: true
      database:
        client: better-sqlite3
        connection: ':memory:'

    integrations:
      github:
        - host: github.com
          token: ${GITHUB_TOKEN}

    proxy:
      '/argocd/api':
        target: https://argocd.idp.local/api/v1/
        changeOrigin: true
        secure: false
        headers:
          Cookie: ${ARGOCD_AUTH_TOKEN}

    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'
      clusterLocatorMethods:
        - type: 'config'
          clusters:
            - url: https://kubernetes.default.svc
              name: local-cluster
              authProvider: 'serviceAccount'
              skipTLSVerify: true
              skipMetricsLookup: false

    catalog:
      import:
        entityFilename: catalog-info.yaml
        pullRequestBranchName: backstage-integration
      rules:
        - allow: [Component, System, API, Resource, Location]
      locations:
        - type: file
          target: /app/catalog/idp-components.yaml
        - type: file
          target: /app/templates/web-application-template.yaml

    scaffolder:
      defaultAuthor:
        name: IDP Platform
        email: idp@company.com
      defaultCommitMessage: 'Initial commit from IDP Platform'

    auth:
      providers:
        guest:
          dangerouslyAllowOutsideDevelopment: true

    techdocs:
      builder: 'local'
      generator:
        runIn: 'local'
      publisher:
        type: 'local'